<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Forensic Surgery Report - Reality Check</title>
    
    <!-- CSS Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
        }
        
        .header h1 {
            color: #ff4444;
            font-size: 2.5em;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #888;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        .dox-score {
            display: inline-block;
            background: #ff4444;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 2em;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }
        
        .section {
            background: #1a1a1a;
            margin-bottom: 30px;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #333;
        }
        
        .section h2 {
            color: #ff6666;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .map-container {
            height: 500px;
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .timeline-container {
            height: 400px;
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .dossier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dossier-item {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ff4444;
        }
        
        .dossier-item h3 {
            color: #ff6666;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .dossier-item .value {
            color: #fff;
            font-size: 1.1em;
            word-break: break-word;
        }
        
        .warning {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff6666;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .info {
            background: rgba(68, 170, 255, 0.1);
            border: 1px solid #44aaff;
            color: #66bbff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .evidence-list {
            list-style: none;
        }
        
        .evidence-list li {
            background: #2a2a2a;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid #ff6666;
        }
        
        .evidence-list .type {
            color: #ff4444;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }
        
        .evidence-list .content {
            color: #ccc;
            margin-top: 5px;
        }
        
        .timestamp {
            color: #888;
            font-size: 0.9em;
            float: right;
        }
        
        .threat-level {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .threat-critical { background: #ff4444; color: white; }
        .threat-high { background: #ff8800; color: white; }
        .threat-medium { background: #ffcc00; color: black; }
        .threat-low { background: #00cc00; color: white; }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #333;
        }
        
        .loading {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .dox-score { font-size: 1.5em; }
            .map-container, .timeline-container { height: 300px; }
        }
    </style>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/vis-timeline@7.7.0/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vis-timeline@7.7.0/styles/vis-timeline-graph2d.min.css" />
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç Digital Forensic Surgery Report</h1>
            <div class="subtitle">Reality Check: Your Digital Footprint Exposed</div>
            <div class="dox-score" id="doxScore">DOX SCORE: {{ dox_score }}/100</div>
        </div>
        
        <!-- Executive Summary -->
        <div class="section">
            <h2>üìä Executive Summary</h2>
            <div class="warning">
                <strong>‚ö†Ô∏è WARNING:</strong> This report contains sensitive information that could be used to identify, locate, or harm you. 
                Treat this as classified information.
            </div>
            <div class="info">
                <strong>‚ÑπÔ∏è Generated:</strong> {{ scan_timestamp }} | 
                <strong>üñ•Ô∏è System:</strong> {{ system_info.username }} ({{ system_info.hostname }}) |
                <strong>üìç Location:</strong> {{ system_info.location or 'Unknown' }}
            </div>
            <div class="info">
                <strong>üìà Statistics:</strong> {{ total_evidence }} pieces of evidence found across {{ evidence_categories|length }} categories.
            </div>
        </div>
        
        <!-- Geographic Intelligence -->
        <div class="section">
            <h2>üó∫Ô∏è Geographic Intelligence (Digital Breadcrumbs)</h2>
            <div id="mapContainer" class="map-container">
                <div class="loading">üìç Loading location data...</div>
            </div>
            <div id="locationSummary" class="info">
                Loading geographic analysis...
            </div>
        </div>
        
        <!-- Activity Timeline -->
        <div class="section">
            <h2>‚è∞ Activity Timeline</h2>
            <div id="timelineContainer" class="timeline-container">
                <div class="loading">‚è∞ Loading timeline data...</div>
            </div>
            <div id="timelineSummary" class="info">
                Loading activity timeline...
            </div>
        </div>
        
        <!-- Personal Dossier -->
        <div class="section">
            <h2>üìã Personal Dossier</h2>
            <div class="warning">
                <strong>üîì UNCLASSIFIED:</strong> The following information can be extracted from your device with minimal effort.
            </div>
            <div class="dossier-grid">
                <div class="dossier-item">
                    <h3>üë§ Full Name</h3>
                    <div class="value" id="fullName">{{ personal_data.full_name or 'Not found in plain text' }}</div>
                </div>
                <div class="dossier-item">
                    <h3>üìß Email Address</h3>
                    <div class="value" id="emailAddress">{{ personal_data.email or 'Not found in plain text' }}</div>
                </div>
                <div class="dossier-item">
                    <h3>üì± Phone Number</h3>
                    <div class="value" id="phoneNumber">{{ personal_data.phone or 'Not found in plain text' }}</div>
                </div>
                <div class="dossier-item">
                    <h3>üè† Physical Address</h3>
                    <div class="value" id="address">{{ personal_data.address or 'Not found in plain text' }}</div>
                </div>
                <div class="dossier-item">
                    <h3>üéÆ Gaming Accounts</h3>
                    <div class="value" id="gamingAccounts">{{ gaming_matches|length }} accounts found</div>
                </div>
                <div class="dossier-item">
                    <h3>üí≥ Financial Clues</h3>
                    <div class="value" id="financialClues">{{ financial_evidence|length }} financial artifacts found</div>
                </div>
            </div>
        </div>
        
        <!-- OSINT Findings -->
        <div class="section">
            <h2>üîç OSINT Discoveries (Public Identity)</h2>
            {% if osint_matches %}
                <div class="warning">
                    <strong>üéØ {{ osint_matches|length }} PUBLIC PROFILES FOUND</strong>
                </div>
                <div class="dossier-grid">
                    {% for match in osint_matches %}
                    <div class="dossier-item">
                        <h3>üåê {{ match.platform }}</h3>
                        <div class="value">
                            <a href="{{ match.url }}" target="_blank" style="color: #66bbff;">{{ match.username }}</a>
                            <div style="margin-top: 10px;">
                                <span class="threat-level threat-{{ match.risk_level|lower }}">{{ match.risk_level }} Risk</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="info">
                    No public profiles found with this username. Consider yourself lucky.
                </div>
            {% endif %}
        </div>
        
        <!-- Browser Intelligence -->
        <div class="section">
            <h2>üïµÔ∏è Browser Intelligence</h2>
            <div class="info">
                Browser data extracted from {{ browser_profiles|length }} browser profiles
            </div>
            {% if autofill_data %}
                <h3>üìù Autofill Data</h3>
                <ul class="evidence-list">
                    {% for item in autofill_data[:10] %}
                    <li>
                        <div class="timestamp">{{ item.timestamp }}</div>
                        <div class="type">{{ item.field_name }}</div>
                        <div class="content">{{ item.field_value }}</div>
                    </li>
                    {% endfor %}
                </ul>
                {% if autofill_data|length > 10 %}
                    <div class="info">... and {{ autofill_data|length - 10 }} more items</div>
                {% endif %}
            {% endif %}
            
            {% if download_data %}
                <h3>üíæ Recent Downloads</h3>
                <ul class="evidence-list">
                    {% for download in download_data[:5] %}
                    <li>
                        <div class="timestamp">{{ download.timestamp }}</div>
                        <div class="type">Download</div>
                        <div class="content">{{ download.filename }} from {{ download.source_url }}</div>
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <!-- Threat Assessment -->
        <div class="section">
            <h2>‚ö†Ô∏è Threat Assessment</h2>
            <div class="info">
                <strong>Overall Risk Level:</strong> 
                <span class="threat-level threat-{{ overall_risk_level|lower }}">{{ overall_risk_level|upper }}</span>
            </div>
            
            <h3>üéØ Attack Scenarios</h3>
            <ul class="evidence-list">
                {% for scenario in attack_scenarios %}
                <li>
                    <div class="type">{{ scenario.title }}</div>
                    <div class="content">{{ scenario.description }}</div>
                    <div style="margin-top: 10px;">
                        <span class="threat-level threat-{{ scenario.severity|lower }}">{{ scenario.severity }}</span>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        <!-- Recommendations -->
        <div class="section">
            <h2>üõ°Ô∏è Immediate Recommendations</h2>
            <div class="warning">
                <strong>URGENT:</strong> The information in this report could be used to:
            </div>
            <ul class="evidence-list">
                {% for recommendation in recommendations %}
                <li>
                    <div class="content">{{ recommendation }}</div>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>üîí CLASSIFIED: Digital Forensic Surgery Report</strong></p>
            <p>Generated by Digital Forensic Surgeon v1.0</p>
            <p><em>"If I found this in 60 seconds, imagine what a hacker finds in a week."</em></p>
        </div>
    </div>
    
    <!-- JavaScript for dynamic content -->
    <script>
        // Map data will be injected here
        window.mapData = {{ map_data|tojson }};
        window.timelineData = {{ timeline_data|tojson }};
        
        // Initialize visualizations when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            initializeTimeline();
            updateSummaries();
        });
        
        function initializeMap() {
            const mapContainer = document.getElementById('mapContainer');
            if (!window.mapData || window.mapData.length === 0) {
                mapContainer.innerHTML = '<div class="loading">üó∫Ô∏è No GPS coordinates found in image metadata</div>';
                return;
            }
            
            const map = L.map('mapContainer').setView([37.7749, -122.4194], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add markers for each GPS coordinate
            window.mapData.forEach((location, index) => {
                const marker = L.marker([location.lat, location.lon]).addTo(map);
                marker.bindPopup(`
                    <strong>üìç Location ${index + 1}</strong><br>
                    <strong>üì∑ Image:</strong> ${location.filename}<br>
                    <strong>üìÖ Taken:</strong> ${location.timestamp}<br>
                    <strong>üì± Camera:</strong> ${location.camera || 'Unknown'}
                `);
            });
            
            // Fit map to show all markers
            if (window.mapData.length > 0) {
                const group = new L.featureGroup(
                    window.mapData.map(loc => L.marker([loc.lat, loc.lon]))
                );
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        function initializeTimeline() {
            const timelineContainer = document.getElementById('timelineContainer');
            if (!window.timelineData || window.timelineData.length === 0) {
                timelineContainer.innerHTML = '<div class="loading">‚è∞ No timeline data available</div>';
                return;
            }
            
            const items = new vis.DataSet(window.timelineData);
            const options = {
                start: new Date(),
                end: new Date(new Date().getTime() + 1000*60*60*24), // 1 day ahead
                editable: false,
                margin: {
                    item: 20,
                    axis: 5
                },
                style: 'box',
                dataAttributes: ['selected'],
                className: 'vis-item-{{ type }}'
            };
            
            const timeline = new vis.Timeline(timelineContainer, items, options);
        }
        
        function updateSummaries() {
            // Update location summary
            const locationSummary = document.getElementById('locationSummary');
            if (window.mapData && window.mapData.length > 0) {
                locationSummary.innerHTML = `
                    <strong>üìç GPS Analysis:</strong> Found GPS coordinates in ${window.mapData.length} images. 
                    This creates a detailed map of your physical movements and locations you've visited.
                `;
            } else {
                locationSummary.innerHTML = '<strong>üìç GPS Analysis:</strong> No GPS coordinates found in image metadata.';
            }
            
            // Update timeline summary
            const timelineSummary = document.getElementById('timelineSummary');
            if (window.timelineData && window.timelineData.length > 0) {
                timelineSummary.innerHTML = `
                    <strong>‚è∞ Timeline Analysis:</strong> ${window.timelineData.length} activities tracked across your digital footprint.
                    This shows patterns in your behavior and when you're most active.
                `;
            } else {
                timelineSummary.innerHTML = '<strong>‚è∞ Timeline Analysis:</strong> No timeline data available.';
            }
        }
    </script>
</body>
</html>